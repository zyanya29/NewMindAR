<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      body { margin: 0; overflow: hidden; }
      /* Ayuda / hint */
      #hint {
        position: fixed;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.6);
        color: #fff;
        padding: 8px 14px;
        border-radius: 9999px;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        font-size: 14px;
        letter-spacing: .2px;
        z-index: 9999;
        pointer-events: none;
        box-shadow: 0 4px 16px rgba(0,0,0,.25);
      }

      /* Bot√≥n: mantener presionado para girar */
      #spinBtn {
        position: fixed;
        bottom: 16px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10000;
        padding: 12px 18px;
        border: 0;
        border-radius: 9999px;
        font-size: 15px;
        font-weight: 600;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: #0ea5e9;
        color: white;
        box-shadow: 0 8px 24px rgba(0,0,0,.2);
        cursor: pointer;
        touch-action: none;         /* evita gestos que roben el toque */
        -webkit-user-select: none;  /* evita selecci√≥n en iOS */
        user-select: none;
      }
      #spinBtn.holding { background: #0284c7; } /* color cuando est√° presionado */
    </style>

    <script>
      // Componente: gira (horario) mientras la bandera global est√° activa
      AFRAME.registerComponent('spin-while-held', {
        schema: { speed: { type: 'number', default: 180 } }, // grados/segundo
        tick: function (time, dt) {
          if (!window.__spinHeld) return;
          const rot = this.el.getAttribute('rotation') || {x:0,y:0,z:0};
          // Sentido horario sobre Z => disminuir √°ngulo (regla de la mano derecha)
          rot.y -= (this.data.speed * (dt / 1000));
          this.el.setAttribute('rotation', rot);
        }
      });

      // Manejo robusto de presionado (desktop/m√≥vil) con Pointer Events + fallbacks
      function setHeld(v) {
        window.__spinHeld = v;
        const btn = document.getElementById('spinBtn');
        if (btn) {
          if (v) {
            btn.classList.add('holding');
            btn.textContent = '‚è±Ô∏è Girando (mant√©n presionado)‚Ä¶';
          } else {
            btn.classList.remove('holding');
            btn.textContent = 'üîÅ Mant√©n presionado para girar';
          }
        }
      }

      function wireHoldButton() {
        const btn = document.getElementById('spinBtn');
        if (!btn) return;

        const down = (e) => { e.preventDefault(); setHeld(true); };
        const up   = () => setHeld(false);

        // Pointer Events (soportado en iOS/Android modernos y desktop)
        btn.addEventListener('pointerdown', down);
        btn.addEventListener('pointerup', up);
        btn.addEventListener('pointercancel', up);
        btn.addEventListener('pointerleave', up);

        // Fallbacks adicionales por si el navegador no usa pointer events
        btn.addEventListener('mousedown', down);
        window.addEventListener('mouseup', up);

        btn.addEventListener('touchstart', down, {passive:false});
        window.addEventListener('touchend', up, {passive:true});
        window.addEventListener('touchcancel', up, {passive:true});
      }

      document.addEventListener('DOMContentLoaded', () => {
        setHeld(false);
        wireHoldButton();
      });
    </script>
  </head>
  <body>
    <!-- Hint actualizado -->
    <div id="hint">Mant√©n presionado el bot√≥n para hacer girar los modelos</div>
    <!-- Bot√≥n actualizado -->
    <button id="spinBtn">üîÅ Mant√©n presionado para girar</button>

    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; maxTrack: 2"
      color-space="sRGB"
      renderer="colorManagement: true; physicallyCorrectLights: true"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      embedded
    >
      <a-assets>
        <!-- Reemplaza estas rutas por las tuyas -->
        <a-asset-item id="chairModel" src="./chair.glb"></a-asset-item>
        <a-asset-item id="ojoModel" src="./ojo.glb"></a-asset-item>
      </a-assets>

      <!-- C√°mara simple -->
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Target 0 -->
      <a-entity mindar-image-target="targetIndex: 0">
        <a-gltf-model
          id="modelA"
          position="0 -0.25 0"
          scale="1.0 1.0 1.0"
          src="#chairModel"
          animation-mixer
          spin-while-held="speed: 180">
        </a-gltf-model>
      </a-entity>

      <!-- Target 1 -->
      <a-entity mindar-image-target="targetIndex: 1">
        <a-gltf-model
          id="modelB"
          position="0 -0.25 0"
          scale="0.0060 0.0060 0.0060"
          src="#ojoModel"
          animation-mixer
          spin-while-held="speed: 180">
        </a-gltf-model>
      </a-entity>
    </a-scene>
  </body>
</html>


