<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body{margin:0;overflow:hidden}
      #hint{
        position:fixed;top:12px;left:50%;transform:translateX(-50%);
        background:rgba(0,0,0,.6);color:#fff;padding:8px 14px;border-radius:9999px;
        font:14px/1.2 system-ui;-webkit-user-select:none;user-select:none;pointer-events:none;z-index:9999
      }
      #swapBtn{
        position:fixed;bottom:16px;left:50%;transform:translateX(-50%);
        z-index:10000;padding:12px 18px;border:0;border-radius:9999px;
        font:600 15px system-ui;background:#0ea5e9;color:#fff;box-shadow:0 8px 24px rgba(0,0,0,.2)
      }
      #swapBtn:disabled{opacity:.6}
    </style>
    <script>
      // Alternar visibilidad sin tocar src: robusto en m칩vil y desktop
      function toggleVisible(pairA, pairB){
        // pair = [entidadModelo1, entidadModelo2]
        const [a1, a2] = pairA, [b1, b2] = pairB;
        a1.setAttribute('visible', !a1.getAttribute('visible'));
        a2.setAttribute('visible', !a2.getAttribute('visible'));
        b1.setAttribute('visible', !b1.getAttribute('visible'));
        b2.setAttribute('visible', !b2.getAttribute('visible'));
      }

      function allLoaded(elements, cb){
        let left = elements.length;
        const done = () => (--left === 0 && cb());
        elements.forEach(el => {
          if (el.hasLoaded) return done();
          el.addEventListener('model-loaded', done, {once:true});
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        const a1 = document.getElementById('t0_model1');
        const a2 = document.getElementById('t0_model2');
        const b1 = document.getElementById('t1_model1');
        const b2 = document.getElementById('t1_model2');
        const btn = document.getElementById('swapBtn');

        // Habilita cuando todos est치n listos (una sola carga, sin cambios de src)
        allLoaded([a1,a2,b1,b2], () => btn.disabled = false);

        btn.addEventListener('click', () => {
          btn.disabled = true; // antirebote breve
          toggleVisible([a1,a2],[b1,b2]);
          setTimeout(() => btn.disabled = false, 150);
        });
      });
    </script>
  </head>
  <body>
    <div id="hint">Pulsa el bot칩n para alternar los modelos de cada marcador</div>
    <button id="swapBtn" disabled>游대 Cambiar modelos</button>

    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; maxTrack: 2"
      color-space="sRGB"
      renderer="colorManagement: true; physicallyCorrectLights: true"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      embedded
    >
      <a-assets>
        <!-- Reemplaza estas rutas por tus GLB/GLTF -->
        <a-asset-item id="t0_m1" src="./ball.glb"></a-asset-item>
        <a-asset-item id="t0_m2" src="./ojo.glb"></a-asset-item>
        <a-asset-item id="t1_m1" src="./silla.glb"></a-asset-item>
        <a-asset-item id="t1_m2" src="./trono.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

      <!-- TARGET 0 -->
      <a-entity mindar-image-target="targetIndex: 0">
        <!-- Modelo 1 (visible) -->
        <a-entity id="t0_model1" visible="true" position="0 -0.25 0" scale="0.05 0.05 0.05">
          <a-gltf-model src="#t0_m1" animation-mixer></a-gltf-model>
        </a-entity>
        <!-- Modelo 2 (oculto al inicio) -->
        <a-entity id="t0_model2" visible="false" position="0 -0.25 0" scale="0.2 0.2 0.2">
          <a-gltf-model src="#t0_m2" animation-mixer></a-gltf-model>
        </a-entity>
      </a-entity>

      <!-- TARGET 1 -->
      <a-entity mindar-image-target="targetIndex: 1">
        <a-entity id="t1_model1" visible="true" position="0 -0.25 0" scale="0.2 0.2 0.2">
          <a-gltf-model src="#t1_m1" animation-mixer></a-gltf-model>
        </a-entity>
        <a-entity id="t1_model2" visible="false" position="0 -0.25 0" scale="0.2 0.2 0.2">
          <a-gltf-model src="#t1_m2" animation-mixer></a-gltf-model>
        </a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>

